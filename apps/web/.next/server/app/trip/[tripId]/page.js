(()=>{var e={};e.id=659,e.ids=[659],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},2081:e=>{"use strict";e.exports=require("child_process")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},9116:()=>{},5292:()=>{},4e3:()=>{},244:()=>{},5903:()=>{},221:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>c});var s=r(117),i=r(2994),n=r(4898),a=r.n(n),o=r(6083),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["trip",{children:["[tripId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8237)),"C:\\Users\\HP\\sisimovego\\apps\\web\\src\\app\\trip\\[tripId]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,1255)),"C:\\Users\\HP\\sisimovego\\apps\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,8658,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\HP\\sisimovego\\apps\\web\\src\\app\\trip\\[tripId]\\page.tsx"],u="/trip/[tripId]/page",p={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/trip/[tripId]/page",pathname:"/trip/[tripId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2403:(e,t,r)=>{Promise.resolve().then(r.bind(r,8017)),Promise.resolve().then(r.bind(r,4409)),Promise.resolve().then(r.bind(r,1482)),Promise.resolve().then(r.bind(r,5754))},8017:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(2281),i=r(2493),n=r(8983),a=r(1932);function o({serverTrip:e}){let t=(0,a.useRouter)(),[r,o]=(0,i.useState)(1),[l,c]=(0,i.useState)(!1);async function d(s){if(s?.preventDefault(),e){c(!0);try{let s=await n.V.createBooking({tripId:e.id,seats:r}),i=s.bookingId??s.booking?.id;t.push(`/payments/checkout?bookingId=${encodeURIComponent(i)}`)}catch(e){alert(e?.message||"Booking failed")}finally{c(!1)}}}return(0,s.jsxs)("form",{onSubmit:d,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Seats"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[s.jsx("button",{type:"button",onClick:()=>o(Math.max(1,r-1)),className:"px-3 py-1 border rounded",children:"-"}),s.jsx("div",{className:"w-10 text-center",children:r}),s.jsx("button",{type:"button",onClick:()=>o(Math.min(e.seatsAvailable??1,r+1)),className:"px-3 py-1 border rounded",children:"+"})]})]}),s.jsx("div",{children:(0,s.jsxs)("div",{className:"text-lg font-semibold",children:["KES ",(e.fareCents/100).toFixed(2)]})}),s.jsx("div",{children:s.jsx("button",{disabled:l,type:"submit",className:"px-4 py-2 bg-primary text-white rounded",children:l?"Booking...":`Book ${r} seat${r>1?"s":""}`})})]})}},4409:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var s=r(2281),i=r(2493),n=r(8267),a=r(6289),o=r(6482),l=r(5715),c=r(4460),d=r(9116),u=r.n(d);r(5292);let p=u().icon({iconUrl:"/leaflet/marker-icon.png",shadowUrl:"/leaflet/marker-shadow.png",iconAnchor:[12,41]});function x({coords:e}){let t=(0,n.Sx)();return(0,i.useEffect)(()=>{if(!t||!e||0===e.length)return;let r=u().latLngBounds(e);t.fitBounds(r.pad(.15))},[e,t]),null}function m({active:e,position:t}){let r=(0,n.Sx)();return(0,i.useEffect)(()=>{r&&e&&t&&r.setView(t,r.getZoom(),{animate:!0})},[e,t,r]),null}function h({center:e=[0,0],zoom:t=13,markers:r=[],fitBounds:i=!1,children:n,height:d="100%",autoFollow:u=!1,followPosition:p=null}){return s.jsx("div",{style:{height:d,width:"100%"},children:(0,s.jsxs)(a.h,{center:e,zoom:t,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},children:[s.jsx(o.I,{attribution:"\xa9 OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),i&&r.length>0&&s.jsx(x,{coords:r.map(e=>[e.lat,e.lng])}),u&&p&&s.jsx(m,{active:u,position:p}),r.map((e,t)=>s.jsx(l.J,{position:[e.lat,e.lng],children:e.popup&&s.jsx(c.G,{children:e.popup})},t)),n]})})}function g({position:e,driver:t,title:r}){let n=(0,i.useRef)(null),a=u().divIcon({className:"driver-marker",html:`
      <div style="display:flex;flex-direction:column;align-items:center">
        <div style="width:40px;height:40px;border-radius:50%;overflow:hidden;border:2px solid white;box-shadow:0 1px 3px rgba(0,0,0,0.2)">
          <img src="${t?.avatarUrl??"/icons/driver.png"}" style="width:40px;height:40px;object-fit:cover" />
        </div>
        <div style="background:rgba(0,0,0,0.6);color:white;padding:2px 6px;border-radius:6px;margin-top:6px;font-size:11px">
          ${t?.name??r??"Driver"}
        </div>
      </div>
    `,iconSize:[40,58],iconAnchor:[20,58]});return(0,i.useEffect)(()=>{if(!n.current)return;let t=n.current,r=t.getLatLng(),s=u().latLng(e[0],e[1]),i=Math.max(6,Math.round(37.5)),a=0,o=(s.lat-r.lat)/i,l=(s.lng-r.lng)/i,c=()=>{a++;let e=u().latLng(r.lat+o*a,r.lng+l*a);t.setLatLng(e),a<i&&requestAnimationFrame(c)};requestAnimationFrame(c)},[e]),s.jsx(l.J,{ref:e=>{n.current=e},position:e,icon:a})}u().Marker.prototype.options.icon=p;var f=r(448),v=r(7684);let b=null;function y({tripId:e}){let{driverLocation:t,trip:r}=function(e){let[t,r]=(0,i.useState)(!1),[s,n]=(0,i.useState)(null),[a,o]=(0,i.useState)(null),[l,c]=(0,i.useState)(null),d=(0,i.useRef)(null),u=(0,i.useRef)({}),p=(0,i.useRef)(null);function x(){p.current||(p.current=setTimeout(()=>{p.current=null,function(){let e=u.current;e.loc&&n(e.loc),e.trip&&o(t=>({...t||{},...e.trip})),void 0!==e.status&&c(e.status),u.current={}}()},200))}return(0,i.useEffect)(()=>{if(!e)return;let t=function(){if(b)return b;let e=process.env.NEXT_PUBLIC_API_WS||"http://localhost:3001";return b=(0,f.io)(e,{auth:{token:v.t.get("sisimove_token")}})}();d.current=t;let s=()=>{r(!0),t.emit("subscribe:trip",{tripId:e}),t.emit("get:trip",{tripId:e})},i=()=>{r(!1)},n=e=>{let t=function(e){if(!e)return null;let t=Number(e.lat??e.latitude??e.lat_gps),r=Number(e.lng??e.longitude??e.lng_gps),s=e.ts??e.time??new Date().toISOString();return Number.isNaN(t)||Number.isNaN(r)?null:{lat:t,lng:r,ts:s,driverId:e.driverId??e.driver_id??e.driver?.id}}(e);t&&(u.current.loc=t,x())},a=e=>{let t=e?{id:e.id??e.tripId??e.trip_id,status:e.status??e.state,driver:e.driver??e.driver_info,route:e.route??e.polyline??e.path}:null;t&&(u.current.trip=t,x())},o=e=>{let t=e?.status??e??null;u.current.status=t,x()};return t.on("connect",s),t.on("disconnect",i),t.on("driver:location",n),t.on("trip:update",a),t.on("trip:status",o),()=>{try{t.emit("unsubscribe:trip",{tripId:e})}catch{}t.off("connect",s),t.off("disconnect",i),t.off("driver:location",n),t.off("trip:update",a),t.off("trip:status",o),p.current&&(clearTimeout(p.current),p.current=null),d.current=null}},[e]),{connected:t,driverLocation:s,trip:a,status:l,socket:d.current}}(e),n=t?[t.lat,t.lng]:r?.origin?.lat?[r.origin.lat,r.origin.lng]:[0,0];return s.jsx("div",{className:"h-96 rounded overflow-hidden shadow",children:s.jsx(h,{center:n,zoom:13,autoFollow:!0,followPosition:t?[t.lat,t.lng]:null,children:t&&s.jsx(g,{position:[t.lat,t.lng]})})})}},1482:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(2281);let i=(0,r(9066).Z)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);function n({rating:e=0}){let t=Math.round(e);return s.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(e=>s.jsx(i,{size:16,className:e<=t?"text-yellow-500 fill-yellow-500":"text-gray-300"},e))})}function a({driver:e}){return e?(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-white p-4 rounded-xl shadow-sm",children:[s.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden bg-gray-100 shadow-sm flex-shrink-0",children:s.jsx("img",{src:e.avatarUrl??"/icons/driver.png",alt:e.name||"Driver",className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-800",children:e.name??"Driver"}),e.vehicle&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[e.vehicle.brand," • ",e.vehicle.plate]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx(n,{rating:e.rating??4.6}),(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e.ratingCount??18,")"]})]})]}),e.phone&&s.jsx("div",{className:"text-sm text-gray-600 text-right",children:e.phone})]}):null}},8237:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h,metadata:()=>x});var s=r(7469),i=r(5912),n=r(9869);let a=(0,r(3610).createProxy)(String.raw`C:\Users\HP\sisimovego\apps\web\src\app\trip\[tripId]\_TripInner.tsx`),{__esModule:o,$$typeof:l}=a,c=a.default;var d=r(4215),u=r(437);let p=(0,d.default)(()=>r.e(47).then(r.bind(r,47)),{loadableGenerated:{modules:["C:\\Users\\HP\\sisimovego\\apps\\web\\src\\app\\trip\\[tripId]\\page.tsx -> ./realtime/ClientWrapper"]},ssr:!1}),x=(0,u.Z)({title:"Trip details"});async function m(e){let t=i.b.TRIP_GET(e),r=await fetch(t,{next:{revalidate:30}});if(!r.ok)throw Error("Failed to fetch trip");let s=await r.json();return s.trip??s}async function h({params:e}){let t=e.tripId,r=null;try{r=await m(t)}catch(e){return console.error("Trip fetch error",e),(0,s.jsxs)("div",{className:"p-6",children:[s.jsx("h2",{className:"text-xl font-semibold",children:"Trip not found"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"We couldn't load that trip."})]})}return s.jsx("div",{className:"max-w-5xl mx-auto p-6 space-y-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 bg-white p-4 rounded shadow",children:[(0,s.jsxs)("h1",{className:"text-xl font-semibold",children:[r.origin.address," → ",r.destination.address]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Departure: ",new Date(r.departureAt).toLocaleString()]}),s.jsx("div",{className:"mt-4",children:s.jsx(c,{serverTrip:r})})]}),(0,s.jsxs)("aside",{className:"bg-white p-4 rounded shadow space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Driver"}),s.jsx(n.ZP,{driver:r.driver})]}),(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-sm text-gray-500",children:"Live tracking"}),s.jsx("div",{className:"mt-2 h-44",children:s.jsx(p,{tripId:t})})]})]})]})})}},9869:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>a});let s=(0,r(3610).createProxy)(String.raw`C:\Users\HP\sisimovego\apps\web\src\components\DriverCard.tsx`),{__esModule:i,$$typeof:n}=s,a=s.default},5912:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});let s=process.env.NEXT_PUBLIC_API_BASE||"http://localhost:3001/api",i={AUTH_LOGIN:`${s}/auth/login`,AUTH_ME:`${s}/auth/me`,AUTH_REFRESH:`${s}/auth/refresh`,TRIPS_SEARCH:`${s}/trips/search`,TRIP_GET:e=>`${s}/trips/${encodeURIComponent(e)}`,BOOKINGS_CREATE:`${s}/bookings/create`,BOOKINGS_MY:`${s}/bookings/mine`,PAYMENTS_CHECKOUT:`${s}/payments/checkout`,MPESA_STATUS:e=>`${s}/payments/mpesa/status?checkoutId=${encodeURIComponent(e)}`,PUSH_SUBSCRIBE:`${s}/push/subscribe`,PUSH_LIST:`${s}/push/subscriptions`}},437:(e,t,r)=>{"use strict";function s({title:e,description:t,url:r,image:s}){let i="SisiMove — Africa-first ridesharing";return{title:e?`${e} | SisiMove`:i,description:t??"Book intercity and intra-city trips across Africa. Fast, safe, affordable.",metadataBase:new URL("https://sisimove.com"),openGraph:{title:e?`${e} | SisiMove`:i,description:t??"Book intercity and intra-city trips across Africa. Fast, safe, affordable.",url:r??"/",siteName:i,images:[{url:s??"/icons/icon-512.png",width:1200,height:630,alt:"SisiMove Preview"}],type:"website"},twitter:{card:"summary_large_image",title:e?`${e} | SisiMove`:i,description:t??"Book intercity and intra-city trips across Africa. Fast, safe, affordable.",images:[s??"/icons/icon-512.png"]}}}r.d(t,{Z:()=>s})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[875,691,108],()=>r(221));module.exports=s})();