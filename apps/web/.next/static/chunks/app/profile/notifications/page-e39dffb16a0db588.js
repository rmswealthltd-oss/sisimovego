(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{356:function(e,t,n){Promise.resolve().then(n.bind(n,5501)),Promise.resolve().then(n.bind(n,1987))},5501:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(6543),i=n(5729),s=n(187);let o=n(2702).env.NEXT_PUBLIC_VAPID_KEY||"";async function a(){if(!("serviceWorker"in navigator))throw Error("Service workers unsupported");let e=await navigator.serviceWorker.register("/sw.js");return await navigator.serviceWorker.ready,e}async function c(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return null;let e=await navigator.serviceWorker.ready;return await e.pushManager.getSubscription()}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/push/subscribe";if(!("serviceWorker"in navigator)||!("PushManager"in window))throw Error("Push not supported in this browser");if("granted"!==await Notification.requestPermission())throw Error("Permission not granted");let t=await a(),n=await t.pushManager.getSubscription();if(n)return n;let r={userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),n=atob((e+t).replace(/\-/g,"+").replace(/_/g,"/")),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}(o)},i=await t.pushManager.subscribe(r);try{await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:i}),credentials:"include"})}catch(e){console.warn("Failed to send subscription to server:",e)}return i}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>"/push/subscriptions/".concat(e),t=await navigator.serviceWorker.ready,n=await t.pushManager.getSubscription();if(!n)return!0;try{await fetch(e(encodeURIComponent(n.endpoint)),{method:"DELETE",credentials:"include"})}catch(e){console.warn("Failed to inform server about unsubscribe",e)}return await n.unsubscribe()}function d(){let[e,t]=(0,i.useState)([]),[n,o]=(0,i.useState)(!0),[a,d]=(0,i.useState)(null);async function h(){o(!0);try{var e;let[n,r]=await Promise.all([s.V.getSubscriptions().catch(()=>({subs:[]})),c().catch(()=>null)]);t(null!==(e=null==n?void 0:n.subs)&&void 0!==e?e:[]),d(r)}finally{o(!1)}}async function p(){try{let e=await u();d(e),await h()}catch(e){alert((null==e?void 0:e.message)||"Subscribe failed")}}async function f(e){try{e?await s.V.deleteSubscription(e):await l(),await h()}catch(e){console.warn(e)}}return(0,i.useEffect)(()=>{h()},[]),(0,r.jsxs)("div",{className:"max-w-3xl mx-auto p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Notifications"}),(0,r.jsxs)("div",{className:"bg-white p-4 rounded shadow mt-4 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Browser subscription"}),(0,r.jsx)("div",{className:"mt-2",children:a?(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm text-gray-700",children:a.endpoint}),(0,r.jsx)("button",{onClick:()=>f(a.endpoint),className:"px-3 py-1 rounded border text-sm",children:"Unsubscribe"})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Not subscribed"}),(0,r.jsx)("button",{onClick:p,className:"mt-2 px-3 py-1 bg-primary text-white rounded",children:"Enable push"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Server subscriptions"}),(0,r.jsx)("div",{className:"mt-2 space-y-2",children:n?(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Loadingâ€¦"}):e.length?e.map(e=>{var t,n,i;return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-sm text-gray-700",children:null!==(n=null===(t=e.endpoint)||void 0===t?void 0:t.slice(0,60))&&void 0!==n?n:e.id}),(0,r.jsx)("button",{onClick:()=>{var t;return f(null!==(t=e.endpoint)&&void 0!==t?t:e.id)},className:"px-3 py-1 rounded border text-sm",children:"Delete"})]},null!==(i=e.id)&&void 0!==i?i:e.endpoint)}):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"No server subscriptions"})})]})]})]})}},187:function(e,t,n){"use strict";n.d(t,{V:function(){return s}});let r="http://localhost:3001".replace(/\/$/,"")||"http://localhost:5000";async function i(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=localStorage.getItem("token"),o={"Content-Type":"application/json",...i.headers||{}};s&&(o.Authorization="Bearer ".concat(s));let a=await fetch("".concat(r).concat(t),{method:e,headers:o,body:n?JSON.stringify(n):void 0}),c=null;try{c=await a.json()}catch(e){c=null}if(!a.ok){let e=Error((null==c?void 0:c.message)||(null==c?void 0:c.error)||a.statusText);throw e.data=c,e.status=a.status,e}return c}let s={get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i("GET",e,void 0,t)},post(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("POST",e,t,n)},put(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("PUT",e,t,n)},patch(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("PATCH",e,t,n)},delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i("DELETE",e,void 0,t)},getMe(){return this.get("/auth/me")},createBooking(e){return this.post("/bookings/create",e)},getBooking(e){return this.get("/bookings/".concat(encodeURIComponent(e)))},applyPromo(e){return this.post("/promos/apply",e)},createCheckout(e){return this.post("/payments/checkout",e)},getTrip(e){return this.get("/trips/".concat(e))},saveSubscription(e){return this.post("/push/subscribe",{subscription:e})},getSubscriptions(){return this.get("/push/subscriptions")},deleteSubscription(e){return this.delete("/push/subscriptions/".concat(encodeURIComponent(e)))}}},1987:function(e,t,n){"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(3297)},2702:function(e){"use strict";var t,n,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c=[],u=!1,l=-1;function d(){u&&r&&(u=!1,r.length?c=r.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=a(d);u=!0;for(var t=c.length;t;){for(r=c,c=[];++l<t;)r&&r[l].run();l=-1,t=c.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||u||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},function(e){e.O(0,[585,682,744],function(){return e(e.s=356)}),_N_E=e.O()}]);