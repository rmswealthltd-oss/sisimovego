(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[409],{4941:function(t,e,n){Promise.resolve().then(n.bind(n,270)),Promise.resolve().then(n.bind(n,1987))},270:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return u}});var o=n(6543),s=n(5729),r=n(187);async function i(t){let e=await r.V.post("/payments/mpesa/stkPush",t);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.message)||"Mpesa STK Push failed")}return e.json()}async function a(t){let e=await r.V.get("/payments/mpesa/status?requestId=".concat(t));if(!e.ok)throw Error("Failed checking Mpesa status");return e.json()}function u(t){let{checkoutId:e}=t,[n,r]=(0,s.useState)(!1),[u,c]=(0,s.useState)("INIT");async function l(){try{r(!0),c("REQUESTING");let t=await i({phone:"2547XXXXXXXX",amountCents:1e3,bookingId:e});c("PENDING");let n=await a(t.requestId);c(n.status)}catch(t){c("ERROR")}finally{r(!1)}}return(0,o.jsxs)("div",{className:"mt-4",children:[(0,o.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:l,disabled:n,children:"Pay with MPESA"}),(0,o.jsxs)("div",{className:"mt-3 text-gray-800",children:["Status: ",u]})]})}},187:function(t,e,n){"use strict";n.d(e,{V:function(){return r}});let o="http://localhost:3001".replace(/\/$/,"")||"http://localhost:5000";async function s(t,e,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=localStorage.getItem("token"),i={"Content-Type":"application/json",...s.headers||{}};r&&(i.Authorization="Bearer ".concat(r));let a=await fetch("".concat(o).concat(e),{method:t,headers:i,body:n?JSON.stringify(n):void 0}),u=null;try{u=await a.json()}catch(t){u=null}if(!a.ok){let t=Error((null==u?void 0:u.message)||(null==u?void 0:u.error)||a.statusText);throw t.data=u,t.status=a.status,t}return u}let r={get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("GET",t,void 0,e)},post(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("POST",t,e,n)},put(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("PUT",t,e,n)},patch(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("PATCH",t,e,n)},delete(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("DELETE",t,void 0,e)},getMe(){return this.get("/auth/me")},createBooking(t){return this.post("/bookings/create",t)},getBooking(t){return this.get("/bookings/".concat(encodeURIComponent(t)))},applyPromo(t){return this.post("/promos/apply",t)},createCheckout(t){return this.post("/payments/checkout",t)},getTrip(t){return this.get("/trips/".concat(t))},saveSubscription(t){return this.post("/push/subscribe",{subscription:t})},getSubscriptions(){return this.get("/push/subscriptions")},deleteSubscription(t){return this.delete("/push/subscriptions/".concat(encodeURIComponent(t)))}}},1987:function(t,e,n){"use strict";function o(t){let{reason:e,children:n}=t;return n}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"BailoutToCSR",{enumerable:!0,get:function(){return o}}),n(3297)}},function(t){t.O(0,[585,682,744],function(){return t(t.s=4941)}),_N_E=t.O()}]);