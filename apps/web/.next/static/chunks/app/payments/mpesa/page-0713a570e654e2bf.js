(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[409],{4941:function(t,e,n){Promise.resolve().then(n.bind(n,270)),Promise.resolve().then(n.bind(n,1987))},270:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return u}});var s=n(6543),r=n(5729),i=n(187);async function o(t){let e=await i.V.post("/payments/mpesa/stkPush",t);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error((null==t?void 0:t.message)||"Mpesa STK Push failed")}return e.json()}async function a(t){let e=await i.V.get("/payments/mpesa/status?requestId=".concat(t));if(!e.ok)throw Error("Failed checking Mpesa status");return e.json()}function u(t){let{checkoutId:e}=t,[n,i]=(0,r.useState)(!1),[u,c]=(0,r.useState)("INIT");async function l(){try{i(!0),c("REQUESTING");let t=await o({phone:"2547XXXXXXXX",amountCents:1e3,bookingId:e});c("PENDING");let n=await a(t.requestId);c(n.status)}catch(t){c("ERROR")}finally{i(!1)}}return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:l,disabled:n,children:"Pay with MPESA"}),(0,s.jsxs)("div",{className:"mt-3 text-gray-800",children:["Status: ",u]})]})}},187:function(t,e,n){"use strict";n.d(e,{V:function(){return o}});let s="http://localhost:3001".replace(/\/$/,"")||"http://localhost:3001",r="".concat(s,"/api");async function i(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s={"Content-Type":"application/json",...n.headers||{}};n.token&&(s.Authorization="Bearer ".concat(n.token));let i=r+e+function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new URLSearchParams;for(let n in t)void 0!==t[n]&&null!==t[n]&&e.append(n,t[n].toString());let n=e.toString();return n?"?".concat(n):""}(n.params),o=await fetch(i,{method:t,headers:s,credentials:"include",body:n.body?JSON.stringify(n.body):void 0}),a=null;try{a=await o.json()}catch(t){}if(!o.ok){let t=Error((null==a?void 0:a.message)||"Request failed");throw t.status=o.status,t.data=a,t}return a}let o={request:i,get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i("GET",t,e)},post(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("POST",t,{...n,body:e})},put(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("PUT",t,{...n,body:e})},patch(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i("PATCH",t,{...n,body:e})},del(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i("DELETE",t,e)},login(t,e){return this.post("/auth/login",{email:t,password:e})},logout(){return this.post("/auth/logout")},getMe(){return this.get("/auth/me")},getDriverTrips(){return this.get("/drivers/trips")},getDriverBookings(){return this.get("/drivers/bookings")},getWallet(){return this.get("/drivers/wallet/me")},getMyBookings(){return this.get("/passengers/bookings/my")},createBooking(t){return this.post("/passengers/bookings",t)},cancelBooking(t,e){return this.post("/passengers/bookings/cancel",{bookingId:t,reason:e})},getTrips(t){return this.get("/trips",{params:t})},postTrip(t){return this.post("/trips",t)},getSubscriptions(){return this.get("/push/subscription")},saveSubscription(t){return this.post("/push/subscription",{subscription:t})},deleteSubscription(t){return this.del("/push/subscription/".concat(t))},createCheckout(t){return this.post("/passengers/payments/checkout",t)},getPayment(t){return this.get("/payments/".concat(t))},getPaymentsForBooking(t){return this.get("/passengers/bookings/".concat(t,"/payments"))}}},1987:function(t,e,n){"use strict";function s(t){let{reason:e,children:n}=t;return n}Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"BailoutToCSR",{enumerable:!0,get:function(){return s}}),n(3297)}},function(t){t.O(0,[585,682,744],function(){return t(t.s=4941)}),_N_E=t.O()}]);