(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[639],{2476:function(e,t,r){Promise.resolve().then(r.bind(r,2383)),Promise.resolve().then(r.bind(r,1987))},2383:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(6543),i=r(5729),s=r(187);let o=r(2702).env.NEXT_PUBLIC_VAPID_KEY||"";async function a(){if(!("serviceWorker"in navigator))throw Error("Service workers unsupported");let e=await navigator.serviceWorker.register("/sw.js");return await navigator.serviceWorker.ready,e}async function c(){if(!("serviceWorker"in navigator)||!("PushManager"in window))return null;let e=await navigator.serviceWorker.ready;return await e.pushManager.getSubscription()}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/push/subscribe";if(!("serviceWorker"in navigator)||!("PushManager"in window))throw Error("Push not supported in this browser");if("granted"!==await Notification.requestPermission())throw Error("Permission not granted");let t=await a(),r=await t.pushManager.getSubscription();if(r)return r;let n={userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),r=atob((e+t).replace(/\-/g,"+").replace(/_/g,"/")),n=new Uint8Array(r.length);for(let e=0;e<r.length;++e)n[e]=r.charCodeAt(e);return n}(o)},i=await t.pushManager.subscribe(n);try{await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:i}),credentials:"include"})}catch(e){console.warn("Failed to send subscription to server:",e)}return i}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>"/push/subscriptions/".concat(e),t=await navigator.serviceWorker.ready,r=await t.pushManager.getSubscription();if(!r)return!0;try{await fetch(e(encodeURIComponent(r.endpoint)),{method:"DELETE",credentials:"include"})}catch(e){console.warn("Failed to inform server about unsubscribe",e)}return await r.unsubscribe()}function d(){let[e,t]=(0,i.useState)([]),[r,o]=(0,i.useState)(!0),[a,d]=(0,i.useState)(null);async function h(){o(!0);try{var e;let[r,n]=await Promise.all([s.V.getSubscriptions().catch(()=>({subs:[]})),c().catch(()=>null)]),i=Array.isArray(r)?r:null!==(e=null==r?void 0:r.subs)&&void 0!==e?e:[];t(i),d(n)}finally{o(!1)}}async function p(){try{let e=await u();d(e),await h()}catch(e){alert((null==e?void 0:e.message)||"Subscribe failed")}}async function g(e){try{e?await s.V.deleteSubscription(e):await l(),await h()}catch(e){console.warn(e)}}return(0,i.useEffect)(()=>{h()},[]),(0,n.jsxs)("div",{className:"max-w-3xl mx-auto p-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Notifications"}),(0,n.jsxs)("div",{className:"bg-white p-4 rounded shadow mt-4 space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Browser subscription"}),(0,n.jsx)("div",{className:"mt-2",children:a?(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-sm text-gray-700",children:a.endpoint}),(0,n.jsx)("button",{onClick:()=>g(a.endpoint),className:"px-3 py-1 rounded border text-sm",children:"Unsubscribe"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Not subscribed"}),(0,n.jsx)("button",{onClick:p,className:"mt-2 px-3 py-1 bg-primary text-white rounded",children:"Enable push"})]})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Server subscriptions"}),(0,n.jsx)("div",{className:"mt-2 space-y-2",children:r?(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Loadingâ€¦"}):e.length?e.map(e=>{var t,r,i;return(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-sm text-gray-700",children:null!==(r=null===(t=e.endpoint)||void 0===t?void 0:t.slice(0,60))&&void 0!==r?r:e.id}),(0,n.jsx)("button",{onClick:()=>{var t;return g(null!==(t=e.endpoint)&&void 0!==t?t:e.id)},className:"px-3 py-1 rounded border text-sm",children:"Delete"})]},null!==(i=e.id)&&void 0!==i?i:e.endpoint)}):(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"No server subscriptions"})})]})]})]})}},187:function(e,t,r){"use strict";r.d(t,{V:function(){return o}});let n="http://localhost:3001".replace(/\/$/,"")||"http://localhost:3001",i="".concat(n,"/api");async function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={"Content-Type":"application/json",...r.headers||{}};r.token&&(n.Authorization="Bearer ".concat(r.token));let s=i+t+function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;for(let r in e)void 0!==e[r]&&null!==e[r]&&t.append(r,e[r].toString());let r=t.toString();return r?"?".concat(r):""}(r.params),o=await fetch(s,{method:e,headers:n,credentials:"include",body:r.body?JSON.stringify(r.body):void 0}),a=null;try{a=await o.json()}catch(e){}if(!o.ok){let e=Error((null==a?void 0:a.message)||"Request failed");throw e.status=o.status,e.data=a,e}return a}let o={request:s,get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("GET",e,t)},post(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("POST",e,{...r,body:t})},put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("PUT",e,{...r,body:t})},patch(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s("PATCH",e,{...r,body:t})},del(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s("DELETE",e,t)},login(e,t){return this.post("/auth/login",{email:e,password:t})},logout(){return this.post("/auth/logout")},getMe(){return this.get("/auth/me")},getDriverTrips(){return this.get("/drivers/trips")},getDriverBookings(){return this.get("/drivers/bookings")},getWallet(){return this.get("/drivers/wallet/me")},getMyBookings(){return this.get("/passengers/bookings/my")},createBooking(e){return this.post("/passengers/bookings",e)},cancelBooking(e,t){return this.post("/passengers/bookings/cancel",{bookingId:e,reason:t})},getTrips(e){return this.get("/trips",{params:e})},postTrip(e){return this.post("/trips",e)},getSubscriptions(){return this.get("/push/subscription")},saveSubscription(e){return this.post("/push/subscription",{subscription:e})},deleteSubscription(e){return this.del("/push/subscription/".concat(e))},createCheckout(e){return this.post("/passengers/payments/checkout",e)},getPayment(e){return this.get("/payments/".concat(e))},getPaymentsForBooking(e){return this.get("/passengers/bookings/".concat(e,"/payments"))}}},1987:function(e,t,r){"use strict";function n(e){let{reason:t,children:r}=e;return r}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),r(3297)},2702:function(e){"use strict";var t,r,n,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c=[],u=!1,l=-1;function d(){u&&n&&(u=!1,n.length?c=n.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=a(d);u=!0;for(var t=c.length;t;){for(n=c,c=[];++l<t;)n&&n[l].run();l=-1,t=c.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new p(e,t)),1!==c.length||u||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},function(e){e.O(0,[585,682,744],function(){return e(e.s=2476)}),_N_E=e.O()}]);