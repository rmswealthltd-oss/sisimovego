(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{1685:function(e,t,s){Promise.resolve().then(s.bind(s,1432))},494:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(6543),l=s(5729),i=s(7221),a=s(1832),n=s(615),o=s(2244),c=s(7354);let d=(0,l.createContext)({role:null,setRole:()=>{}});function x(e){let{children:t}=e,{user:s}=(0,c.a)(),[i,a]=(0,l.useState)(null);return(0,l.useEffect)(()=>{if(!s){a(null);return}"admin@sisimove.com"===s.email?a("admin"):a("passenger")},[s]),(0,r.jsx)(d.Provider,{value:{role:i,setRole:a},children:t})}function m(){return(0,l.useContext)(d)}function u(e){let{open:t,onClose:s}=e,l=(0,n.usePathname)(),{user:d,logout:x}=(0,c.a)(),{role:u}=m(),h=[{name:"Dashboard",href:"/dashboard",icon:o.m6D},{name:"Search Trips",href:"/dashboard/search",icon:o.i63},{name:"Post a Trip",href:"/dashboard/post-trip",icon:o.xVi,roles:["driver","admin"]},{name:"My Trips",href:"/dashboard/my-trips",icon:o.i63,roles:["passenger","driver"]},{name:"Profile",href:"/dashboard/profile",icon:o.fzv},{name:"Notifications",href:"/dashboard/notifications",icon:o.vWP},{name:"Settings",href:"/dashboard/settings",icon:o.nbt,roles:["admin"]}];return(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)("div",{onClick:s,className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-40 md:hidden"}),(0,r.jsxs)("aside",{className:(0,i.Z)("fixed z-50 inset-y-0 left-0 w-64 bg-white shadow-xl border-r border-gray-200 flex flex-col transition-transform duration-300",t?"translate-x-0":"-translate-x-full md:translate-x-0"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-5 border-b border-gray-200",children:[(0,r.jsx)("h1",{className:"text-xl font-semibold text-orange-500",children:"SisiMove"}),(0,r.jsx)("button",{onClick:s,className:"md:hidden text-gray-600 hover:text-orange-500",children:(0,r.jsx)(o.q5L,{size:22})})]}),(0,r.jsxs)("div",{className:"px-6 py-5 border-b border-gray-200",children:[(0,r.jsx)("p",{className:"text-lg font-medium text-gray-900",children:(null==d?void 0:d.lastName)||"Guest User"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:(null==d?void 0:d.email)||"Not logged in"}),u&&(0,r.jsx)("span",{className:"mt-1 inline-block text-xs px-2 py-1 rounded-md bg-gray-100 text-gray-600 capitalize",children:u})]}),(0,r.jsx)("nav",{className:"flex-1 overflow-y-auto py-4",children:h.filter(e=>!e.roles||e.roles.includes(u||"")).map(e=>{let t=l===e.href,n=e.icon;return(0,r.jsxs)(a.default,{href:e.href,className:(0,i.Z)("flex items-center gap-3 px-6 py-3 text-sm font-medium transition rounded-md",t?"bg-orange-500 text-white shadow-md":"text-gray-700 hover:bg-gray-100"),onClick:s,children:[(0,r.jsx)(n,{size:18}),e.name]},e.href)})}),d&&(0,r.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,r.jsxs)("button",{onClick:x,className:"flex items-center gap-3 text-red-600 font-medium hover:text-red-800 transition",children:[(0,r.jsx)(o.xqh,{size:18}),"Logout"]})})]})]})}function h(e){let{onOpenSidebar:t}=e,{user:s,logout:l,loading:i}=(0,c.a)(),{role:a}=m();return i?(0,r.jsx)("header",{className:"w-full h-16 bg-white border-b shadow-sm"}):(0,r.jsx)("header",{className:"w-full bg-white border-b shadow-sm h-16 flex items-center sticky top-0 z-40",children:(0,r.jsxs)("div",{className:"flex items-center justify-between w-full px-4 md:px-6",children:[(0,r.jsx)("button",{onClick:t,className:"md:hidden p-2 rounded-md border bg-gray-100 hover:bg-gray-200",children:(0,r.jsx)(o.cur,{size:22})}),(0,r.jsx)("h1",{className:"font-semibold text-lg text-gray-800",children:"Dashboard"}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[a&&(0,r.jsx)("span",{className:"text-xs px-2 py-1 rounded-md bg-gray-100 text-gray-600 capitalize",children:a}),s&&(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:s.lastName}),s&&(0,r.jsx)("button",{onClick:l,className:"text-sm px-3 py-1 rounded-md bg-red-500 text-white hover:bg-red-600 transition",children:"Logout"})]})]})})}let p=(0,l.createContext)({notification:null,show:()=>{},clear:()=>{}});function f(e){let{children:t}=e,[s,i]=(0,l.useState)(null);return(0,r.jsx)(p.Provider,{value:{notification:s,show:function(e,t){i({type:e,message:t}),setTimeout(()=>i(null),5e3)},clear:function(){i(null)}},children:t})}function g(e){let{children:t}=e,[s,a]=(0,l.useState)(!1);return(0,r.jsx)(c.H,{children:(0,r.jsx)(x,{children:(0,r.jsx)(f,{children:(0,r.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,r.jsx)(u,{open:s,onClose:()=>a(!1)}),(0,r.jsxs)("div",{className:(0,i.Z)("flex flex-col flex-1 transition-all duration-200",s?"md:ml-64":"md:ml-0"),children:[(0,r.jsx)(h,{onOpenSidebar:()=>a(!0)}),(0,r.jsx)("main",{className:"p-6 w-full max-w-7xl mx-auto",children:t})]})]})})})})}},1432:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var r,l,i,a,n=s(6543),o=s(5729),c=s(615),d=s(494),x=s(6175),m=s(187),u=s(2244);function h(e){let{user:t}=e,s=(0,c.useRouter)(),r="VERIFIED"===t.governmentIdStatus,l="PENDING"===t.governmentIdStatus,i="REJECTED"===t.governmentIdStatus,a="VERIFIED"===t.driverLicenseStatus,o="PENDING"===t.driverLicenseStatus,d="REJECTED"===t.driverLicenseStatus,x="DRIVER"===t.role;return r&&(!x||a)?null:(0,n.jsxs)("div",{className:"bg-yellow-50 border border-yellow-300 rounded-xl p-4 flex flex-col gap-3",children:[(0,n.jsx)("h2",{className:"font-semibold text-yellow-800 text-lg",children:"Complete Your Verification"}),!r&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:"Government ID Verification"}),l&&(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Your ID is being reviewed…"}),i&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:"Your ID was rejected. Please re-upload."})]}),l?(0,n.jsx)("span",{className:"text-xs text-gray-500 italic",children:"Pending"}):(0,n.jsx)("button",{onClick:()=>s.push("/profile/verify-id"),className:"px-4 py-1.5 bg-yellow-600 text-white rounded-lg text-sm hover:bg-yellow-700",children:i?"Re-upload ID":"Upload ID"})]}),x&&!a&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:"Driver License Verification"}),o&&(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Your license is being reviewed…"}),d&&(0,n.jsx)("p",{className:"text-sm text-red-600",children:"License was rejected. Please re-upload."})]}),o?(0,n.jsx)("span",{className:"text-xs text-gray-500 italic",children:"Pending"}):(0,n.jsx)("button",{onClick:()=>s.push("/profile/verify-license"),className:"px-4 py-1.5 bg-yellow-600 text-white rounded-lg text-sm hover:bg-yellow-700",children:d?"Re-upload License":"Upload License"})]})]})}function p(){let e=(0,c.useRouter)(),{user:t,loading:s,token:r}=(0,x.a)(),[l,p]=(0,o.useState)(null),[f,g]=(0,o.useState)([]),[b,N]=(0,o.useState)([]),[j,y]=(0,o.useState)({totalTrips:0,completedTrips:0,totalEarnings:0});if((0,o.useEffect)(()=>{s||t||e.replace("/auth/login")},[s,t,e]),(0,o.useEffect)(()=>{r&&t&&(t.role===i.DRIVER&&"VERIFIED"===t.driverLicenseStatus&&(m.V.get("/drivers/wallet/me",{token:r}).then(e=>p(e.balance)).catch(()=>{}),m.V.get("/drivers/trips",{token:r}).then(e=>{N(e);let t=e.filter(e=>e.status===a.COMPLETED).length,s=e.filter(e=>e.status===a.COMPLETED).reduce((e,t)=>e+t.pricePerSeat*t.totalSeats,0);y({totalTrips:e.length,completedTrips:t,totalEarnings:s})}).catch(()=>{})),t.role===i.PASSENGER&&m.V.get("/passengers/bookings/my",{token:r}).then(g).catch(()=>{}))},[r,t]),s)return(0,n.jsx)("div",{children:"Loading…"});let v=e=>{let{message:t}=e;return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center p-10 border border-dashed border-gray-300 rounded-xl text-gray-400 space-y-2",children:[(0,n.jsx)(u.H33,{className:"text-3xl"}),(0,n.jsx)("p",{children:t})]})};return(0,n.jsxs)(d.default,{children:[t&&(0,n.jsx)(h,{user:t}),(null==t?void 0:t.role)===i.DRIVER&&(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6 mb-6",children:[(0,n.jsxs)("div",{className:"bg-white border rounded-xl shadow p-5 flex items-center gap-3",children:[(0,n.jsx)(u.C4B,{className:"text-primary text-2xl"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Total Trips"}),(0,n.jsx)("p",{className:"text-lg font-semibold",children:j.totalTrips})]})]}),(0,n.jsxs)("div",{className:"bg-white border rounded-xl shadow p-5 flex items-center gap-3",children:[(0,n.jsx)(u._rq,{className:"text-primary text-2xl"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Completed Trips"}),(0,n.jsx)("p",{className:"text-lg font-semibold",children:j.completedTrips})]})]}),(0,n.jsxs)("div",{className:"bg-white border rounded-xl shadow p-5 flex items-center gap-3",children:[(0,n.jsx)(u.oQC,{className:"text-primary text-2xl"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Total Earnings"}),(0,n.jsxs)("p",{className:"text-lg font-semibold",children:["KES ",(j.totalEarnings/100).toFixed(2)]})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(null==t?void 0:t.role)===i.DRIVER&&"VERIFIED"===t.driverLicenseStatus&&(0,n.jsxs)("div",{className:"bg-white border rounded-xl shadow p-5",children:[(0,n.jsxs)("h3",{className:"font-semibold flex items-center gap-2 mb-1",children:[(0,n.jsx)(u.XiQ,{className:"text-primary"})," Wallet Balance"]}),(0,n.jsx)("p",{className:"text-2xl font-bold mt-2",children:null===l?"—":"KES ".concat((l/100).toFixed(2))})]}),(0,n.jsxs)("div",{className:"bg-white border rounded-xl shadow p-5",children:[(0,n.jsxs)("h3",{className:"font-semibold flex items-center gap-2 mb-3",children:[(0,n.jsx)(u.TCC,{className:"text-primary"})," Upcoming Bookings"]}),0===f.length?(0,n.jsx)(v,{message:"No upcoming bookings yet"}):(0,n.jsx)("ul",{className:"space-y-2",children:f.slice(0,5).map(e=>(0,n.jsxs)("li",{className:"text-sm border-b pb-2",children:[(0,n.jsxs)("p",{className:"font-medium",children:[e.trip.toLocation," → ",e.trip.fromLocation]}),(0,n.jsx)("p",{className:"text-xs text-gray-600",children:new Date(e.trip.departureAt).toLocaleString()})]},e.id))})]})]}),(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mt-6",children:0===b.length?(0,n.jsx)(v,{message:"No trips available yet"}):b.map(s=>(0,n.jsxs)("div",{className:"relative bg-white border rounded-xl shadow p-5",children:[(0,n.jsxs)("p",{className:"font-semibold",children:[s.toLocation," → ",s.fromLocation]}),(0,n.jsx)("span",{className:"text-xs inline-block px-2 py-1 bg-gray-100 rounded mt-2",children:s.status}),(0,n.jsxs)("div",{className:"absolute bottom-4 right-4",children:[(null==t?void 0:t.role)===i.PASSENGER&&s.status===a.REQUESTING&&("VERIFIED"!==t.governmentIdStatus?(0,n.jsx)("button",{onClick:()=>e.push("/profile/verify-id"),className:"py-2 px-4 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600",children:"Verify ID to Join Trip"}):(0,n.jsx)("button",{onClick:()=>e.push("/trips/".concat(s.id)),className:"py-2 px-4 bg-primary text-white rounded-lg text-sm hover:bg-primary/90",children:"Join Trip"})),(null==t?void 0:t.role)===i.DRIVER&&s.status===a.REQUESTING&&("VERIFIED"!==t.driverLicenseStatus?(0,n.jsx)("button",{onClick:()=>e.push("/profile/verify-license"),className:"py-2 px-4 bg-yellow-500 text-white rounded-lg text-sm hover:bg-yellow-600",children:"Verify License to Post Trip"}):(0,n.jsx)("button",{onClick:()=>e.push("/trips/".concat(s.id)),className:"py-2 px-4 bg-primary text-white rounded-lg text-sm hover:bg-primary/90",children:"Post Trip"}))]})]},s.id))})]})}(r=i||(i={})).DRIVER="DRIVER",r.PASSENGER="PASSENGER",(l=a||(a={})).REQUESTING="REQUESTING",l.PENDING="PENDING",l.DRIVER_ASSIGNED="DRIVER_ASSIGNED",l.ONGOING="ONGOING",l.COMPLETED="COMPLETED",l.CANCELLED="CANCELLED"},7354:function(e,t,s){"use strict";s.d(t,{H:function(){return c},a:function(){return d}});var r=s(6543),l=s(5729),i=s(148),a=s(187),n=s(615);let o=(0,l.createContext)({user:null,loading:!0,login:async()=>{},logout:()=>{}});function c(e){let{children:t}=e,[s,c]=(0,l.useState)(null),[d,x]=(0,l.useState)(!0),m=(0,n.useRouter)();async function u(){if(!i.t.get("access")){x(!1);return}try{let e=await a.V.getMe();c({...e,fullName:"".concat(e.firstName," ").concat(e.lastName)})}catch(e){i.t.remove("access"),c(null)}finally{x(!1)}}async function h(e,t){let s=await a.V.login(e,t);i.t.set("access",s.token),await u(),m.push("/dashboard")}return(0,l.useEffect)(()=>{u()},[]),(0,r.jsx)(o.Provider,{value:{user:s,loading:d,login:h,logout:function(){i.t.remove("access"),c(null),m.push("/auth/login")}},children:t})}function d(){return(0,l.useContext)(o)}},1832:function(e,t,s){"use strict";s.d(t,{default:function(){return l.a}});var r=s(8062),l=s.n(r)},7221:function(e,t,s){"use strict";t.Z=function(){for(var e,t,s=0,r="",l=arguments.length;s<l;s++)(e=arguments[s])&&(t=function e(t){var s,r,l="";if("string"==typeof t||"number"==typeof t)l+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(s=0;s<i;s++)t[s]&&(r=e(t[s]))&&(l&&(l+=" "),l+=r)}else for(r in t)t[r]&&(l&&(l+=" "),l+=r)}return l}(e))&&(r&&(r+=" "),r+=t);return r}}},function(e){e.O(0,[577,139,805,585,682,744],function(){return e(e.s=1685)}),_N_E=e.O()}]);