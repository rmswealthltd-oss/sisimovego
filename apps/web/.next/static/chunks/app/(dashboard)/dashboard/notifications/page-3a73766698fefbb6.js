(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[523],{5482:function(e,s,t){Promise.resolve().then(t.bind(t,6422))},6422:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return r}});var a=t(6543),i=t(5729);function c(){let[e,s]=(0,i.useState)(!0),[t,c]=(0,i.useState)(!1),[n,l]=(0,i.useState)(!0),r=async()=>{await fetch("/api/notifications/settings",{method:"POST",body:JSON.stringify({email:e,sms:t,inApp:n})}),alert("Settings updated.")};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("label",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Email Notifications"}),(0,a.jsx)("input",{type:"checkbox",checked:e,onChange:e=>s(e.target.checked),className:"toggle-checkbox"})]}),(0,a.jsxs)("label",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"SMS Notifications"}),(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:e=>c(e.target.checked),className:"toggle-checkbox"})]}),(0,a.jsxs)("label",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"In-App Notifications"}),(0,a.jsx)("input",{type:"checkbox",checked:n,onChange:e=>l(e.target.checked),className:"toggle-checkbox"})]}),(0,a.jsx)("button",{onClick:r,className:"bg-primary text-white px-5 py-2 rounded-xl",children:"Save Preferences"})]})}function n(){let[e,s]=(0,i.useState)([]),t=async()=>{let e=await fetch("/api/notifications/list");s(await e.json())};return((0,i.useEffect)(()=>{t()},[]),0===e.length)?(0,a.jsx)("p",{className:"text-gray-500",children:"No notifications yet."}):(0,a.jsx)("ul",{className:"space-y-4",children:e.map(e=>(0,a.jsxs)("li",{className:"border rounded-xl p-4 bg-white",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-800",children:e.title}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:e.body}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:new Date(e.createdAt).toLocaleString()})]},e.id))})}function l(){let[e,s]=(0,i.useState)(!1),[t,c]=(0,i.useState)(!0);(0,i.useEffect)(()=>{!async function(){let e=await fetch("/api/push/status");s((await e.json()).enabled),c(!1)}()},[]);let n=async()=>{var e;c(!0);let t=await (null===(e=navigator.serviceWorker)||void 0===e?void 0:e.ready),a=await fetch("/api/push/public-key"),{publicKey:i}=await a.json(),n=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Uint8Array.from(atob(i),e=>e.charCodeAt(0))});await fetch("/api/push/subscribe",{method:"POST",body:JSON.stringify(n)}),s(!0),c(!1)},l=async()=>{var e;c(!0);let t=await (null===(e=navigator.serviceWorker)||void 0===e?void 0:e.ready),a=await t.pushManager.getSubscription();a&&(await a.unsubscribe(),await fetch("/api/push/unsubscribe",{method:"POST"})),s(!1),c(!1)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"Enable push notifications for urgent trip updates."}),(0,a.jsx)("button",{onClick:e?l:n,disabled:t,className:"px-5 py-2 rounded-xl text-white ".concat(e?"bg-secondary":"bg-primary"," disabled:opacity-50"),children:t?"Processing...":e?"Disable Push Notifications":"Enable Push Notifications"})]})}function r(){return(0,a.jsxs)("div",{className:"max-w-3xl space-y-12",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Notifications"}),(0,a.jsxs)("section",{className:"card space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Notification Preferences"}),(0,a.jsx)(c,{})]}),(0,a.jsxs)("section",{className:"card space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Web Push"}),(0,a.jsx)(l,{})]}),(0,a.jsxs)("section",{className:"card space-y-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Recent In-App Messages"}),(0,a.jsx)(n,{})]})]})}}},function(e){e.O(0,[585,682,744],function(){return e(e.s=5482)}),_N_E=e.O()}]);